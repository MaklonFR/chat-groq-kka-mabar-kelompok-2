<!DOCTYPE html>
<html lang="id" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>Chatbot Sederhana dengan React & Groq</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#ef4444',
            secondary: '#dc2626',
          },
        },
      },
    };
  </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-red-200 via-red-300 to-pink-200 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 transition-colors duration-500">

  <!-- Theme Toggle Button -->
  <div class="flex justify-end p-4">
    <button id="theme-toggle" class="px-3 py-2 bg-white/20 rounded-lg text-sm backdrop-blur-md hover:bg-white/30 transition text-white">
      🌙
    </button>
  </div>

  <!-- React Root -->
  <div id="root" class="p-4"></div>

  <!-- REACT APP -->
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const ChatApp = () => {
      const [message, setMessage] = useState("");
      const [history, setHistory] = useState([]);
      const [isLoading, setIsLoading] = useState(false);
      const chatContainerRef = useRef(null);

      const sendMessage = async () => {
        if (!message.trim()) return;
        setIsLoading(true);

        try {
          const response = await axios.post('https://maklonfr.pythonanywhere.com/chat', {
            message,
            history
          });
          const { reply, history: newHistory } = response.data;
          setHistory(newHistory);
          setMessage("");
        } catch (error) {
          console.error("Error sending message:", error);
          setHistory([...history, { role: "assistant", content: "❌ Tidak dapat terhubung ke server." }]);
        } finally {
          setIsLoading(false);
        }
      };

      const handleKeyPress = (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      };

      useEffect(() => {
        if (chatContainerRef.current) {
          chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;
        }
      }, [history]);

      return (
        <div className="w-full max-w-2xl mx-auto">
          <h1 className="text-3xl font-bold text-center mb-6 text-primary">💬 Chatbot MaklonFR</h1>

          <div ref={chatContainerRef} className="bg-gray-800 rounded-lg shadow-lg p-4 h-[70vh] overflow-y-auto mb-4 border border-gray-700">
            {history.length === 0 ? (
              <div className="text-center text-gray-400 mt-10">
                Ketik pesan Anda untuk memulai percakapan!
              </div>
            ) : (
              history.map((msg, idx) => (
                <div key={idx} className={`mb-4 flex ${msg.role === "user" ? "justify-end" : "justify-start"}`}>
                  <div className={`max-w-[100%] p-3 rounded-lg shadow-md ${
                    msg.role === "user"
                      ? "bg-primary text-white ml-4"
                      : "bg-gray-700 text-gray-100 mr-4"
                  }`}>
                    <div className="text-xs text-gray-300 mb-1 font-medium">
                      {msg.role === "user" ? "Anda" : "Asisten"}
                    </div>
                    {msg.content}
                  </div>
                </div>
              ))
            )}
          </div>

          <div className="flex gap-2 mb-6">
            <textarea
              value={message}
              onChange={(e) => setMessage(e.target.value)}
              onKeyPress={handleKeyPress}
              placeholder="Ketik pesan Anda..."
              className="flex-1 p-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary resize-none h-16 text-gray-100"
              disabled={isLoading}
            />
            <button
              onClick={sendMessage}
              disabled={isLoading || !message.trim()}
              className={`px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors ${
                isLoading || !message.trim() ? "opacity-50 cursor-not-allowed" : ""
              }`}
            >
              {isLoading ? (
                <svg
                  className="animate-spin h-5 w-5 text-white"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
                </svg>
              ) : (
                "Kirim"
              )}
            </button>
          </div>

          <footer className="text-center text-sm text-gray-400 border-t border-gray-700 pt-4">
            &copy; 2025 MaklonFR Chatbot. All rights reserved.
          </footer>
        </div>
      );
    };

    ReactDOM.render(<ChatApp />, document.getElementById("root"));
  </script>

  <!-- Theme Toggle Script -->
  <script>
    const themeToggle = document.getElementById('theme-toggle');
    themeToggle.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      themeToggle.textContent = document.documentElement.classList.contains('dark') ? '🌞' : '🌙';
    });
  </script>
</body>
</html>
